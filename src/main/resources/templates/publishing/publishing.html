<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3">
<head th:replace="layout :: site-head">
    <title>KSFX - Information Retrieval</title>
</head>
<body>
<header th:replace="layout :: site-header"/>
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item active">Publishing</li>
    </ol>
</nav>

<div th:if="${publishingConfigurationsPage.totalPages  > 0}">
    <div th:replace="components/pagination :: pagination(path='/publishing', page=${publishingConfigurationsPage})"></div>
    <div style="float:right"><a th:href="@{/publishing/publishingconfigurationedit}" class="fa fa-plus fa-2x" title="Add Publishing Configuration" alt="Add Publishing Configuration"></a>&nbsp;&nbsp;&nbsp;</div>
    <table class="table table-striped table-responsive-md">
        <thead>
        <header th:replace="components/sortable_table_header :: tableheader(headers=${ {'id','name','info','generate','generatefromcache','generateinbackground','console','schedule','edit','delete'} },sortables=${ {'id','name'} },names=${ {'ID','Name','Info','Generate Report','Generate Report From Cache','Generate in BG','Console','Schedule','Edit','Delete'} },page=${publishingConfigurationsPage},path='/publishing')" />
        </thead>
        <tbody>
        <tr th:each="publishingConfiguration : ${publishingConfigurationsPage.content}">
            <td th:text="${publishingConfiguration.id}"></td>
            <td th:text="${publishingConfiguration.name}"></td>
            <td><a href="#" onclick="$('#standard-modal-iframe').attr('src',$(this).attr('lnk'))" th:attr="lnk=@{/noteviewer/(publishingConfigurationId=${publishingConfiguration.id})}" data-toggle="modal" data-target="#standardModal" class="fa fa-info"></a></td>
            <td><a th:href="@{/publishing/publicationviewer/0/{uri}(uri=${publishingConfiguration.uri})}" class="fa fa-play" alt="Generate Publication" title="Generate Publication"></a></td>
            <td><a th:href="@{/publishing/publicationviewer/1/{uri}(uri=${publishingConfiguration.uri})}" class="fa fa-cloud-download" alt="View From Cache" title="View From Cache"></a></td>
            <td>
                <th:block th:if="!${publishingConfiguration.lockedForCacheUpdate}">
                    <a th:if="!${publicationLoaderRunner.isPublicationRunning(publishingConfiguration)}" th:href="@{/publishing/publishingconfigurationgeneratepublication/{id}(id=${publishingConfiguration.id})}" class="fa fa-play" alt="Generate Publication in Background" title="Generate Publication in Background"></a>
                    <span th:unless="!${publicationLoaderRunner.isPublicationRunning(publishingConfiguration)}" th:inline="text" class="fa fa-spinner fa-pulse fa-2x fa-fw"></span>
                </th:block>
            </td>
            <td><a href="#" onclick="$('#console-iframe').attr('src',$(this).attr('lnk'))" th:attr="lnk=@{/console/publishingConfiguration/{id}(id=${publishingConfiguration.id})}" data-toggle="modal" data-target="#consoleModal" class="fa fa-terminal"></a></td>
            <td>
                <th:block th:if="${!#strings.isEmpty(publishingConfiguration.cronSchedule)}">
                    <span th:if="${publishingConfiguration.cronScheduleEnabled}"><a th:href="@{/publishing/publishingconfigurationdeleteschedule/{id}(id=${publishingConfiguration.id})}" class="fa fa-stop" alt="Disable Scheduling" title="Disable Scheduling"></a></span>
                    <span th:unless="${publishingConfiguration.cronScheduleEnabled}"><a th:href="@{/publishing/publishingconfigurationschedule/{id}(id=${publishingConfiguration.id})}" class="fa fa-clock-o" alt="Enable Scheduling" title="Enable Scheduling"></a></span>
                </th:block>
            </td>
            <td><a th:href="@{/publishing/publishingconfigurationedit/{id}(id=${publishingConfiguration.id})}" class="fa fa-pencil" alt="Edit" title="Edit"></a></td>
            <td><a th:attr="data-href=@{/publishing/publishingconfigurationdelete/{id}(id=${publishingConfiguration.id})}" data-toggle="modal" data-target="#standard-confirm" class="fa fa-trash-o" alt="Delete" title="Delete"></a></td>
        </tr>
        </tbody>
    </table>
<!--    <div th:replace="web/pagination :: pagination"></div> -->
</div>

<!-- Modal -->
<div class="modal fade" id="consoleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Console</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" style="height:500px">
                <iframe src="/console/" id="console-iframe" style="width:100%;height:100%" frameborder="0"></iframe>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
<!--                <button type="button" class="btn btn-primary">Save changes</button> -->
            </div>
        </div>
    </div>
</div>

<footer th:replace="layout :: site-footer" />
</body>
</html>